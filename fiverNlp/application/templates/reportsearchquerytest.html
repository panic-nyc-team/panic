{% extends "new_layout.html" %}
{% block title %}Reports{% endblock %}
{% block head %}
  {{ super() }}
<style>
    .centered {
  position: absolute;
  top: 33px;
  left: 50%;
  transform: translate(-50%, -50%);
}
</style>

{% endblock %}
<body>
{% block content %}
  <form action="/reporttest" method="POST">
  <input type="hidden" name="id" value="{{report.id}}">
  <input type="hidden" name="type" value="{{report.type}}">
    <section class="mt-5">
        <div class='container pt-5'>
            <div class='row justify-content-center'>
                <div class='row justify-content-center text-center text-white col-lg-12'>
                    <h1>Reports</h1>
                </div>
                <div class="row col-9 mt-3 justify-content-center">
                        <div class="row col-12 justify-content-center">
                            <div class="form-group row justify-content-center m-0 p-0">
                                <div>
                                    <label class="text-white mr-4">Title:</label>
                                      {%if 'default: ' in report.title%}
                                        <input type="text" class="input-theme form-control form-control-sm" name="title" id="title" value="{{report.title}}" readonly>
                                      {%else%}
                                        <input type="text" class="input-theme form-control form-control-sm" name="title" id="title" value="{{report.title}}">
                                      {%endif%}

                                </div>
                                <div class="ml-0 ml-md-3 mt-3 mt-md-0">
                                      <label class="text-white mr-4">Frequency:</label><br>
                                      <select class="input-theme form-control form-control-sm" name="frequency">
                                      {%if report and report.frequency=='Daily'%}
                                      <option selected>Daily</option>
                                      <option>Weekly</option>
                                      <option>Monthly</option>
                                      {%endif%}
                                      {%if report and report.frequency=='Weekly'%}
                                      <option>Daily</option>
                                      <option selected>Weekly</option>
                                      <option>Monthly</option>
                                      {%endif%}
                                      {%if report and report.frequency=='Monthly'%}
                                      <option>Daily</option>
                                      <option>Weekly</option>
                                      <option selected>Monthly</option>
                                      {%endif%}
                                      </select>

<!--                                    <input type="number" class="input-theme form-control form-control-sm" id="inputTag" placeholder="Value here">-->
                                </div>
                                <div class="ml-0 ml-md-3 mt-3 mt-md-0 row text-white">
                                    <div class="col-12"></div>
                                    <div class="col-12"></div>
                                    <div class="col-12 form-check">
                                        {%if(report and report.up_to_date)%}
                                          <input class="form-check-input" type="checkbox" value="yes" id="up_to_date" name="up_to_date" checked>
                                        {%else%}
                                          <input class="form-check-input" type="checkbox" value="yes" id="up_to_date" name="up_to_date">
                                        {%endif%}
                                        <label class="form-check-label ml-2">
                                            Keep up-to-date
                                        </label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-sm bg-theme mt-4">Run Now</button>
                            </div>
                        </div>
                </div>
                <div class="row col-9 mt-3 justify-content-center">
                        <div class="row col-12 justify-content-center">
                            <div class="form-group row justify-content-center m-0 p-0">
                                <div>
                                  <label class="text-white mr-4">Company A:</label>
                                  <select name="first" class="input-theme form-control form-control-sm">
                                    {%for i in companydocuments%}
                                    {%if(i.title==report.first)%}
                                    <option value="{{i.title}}" selected>{{i.title}}</option>
                                    {%else%}
                                    <option value="{{i.title}}">{{i.title}}</option>
                                    {%endif%}
                                    {%endfor%}
                                  </select>
                                </div>
                                <div class="ml-0 ml-md-3 mt-3 mt-md-0">
                                  <label class="text-white mr-4">Search Query:</label>
                                  <select name="second" class="input-theme form-control form-control-sm">
                                    {%for i in searchqueries%}
                                      {%if(i.title==report.second)%}
                                      <option value="{{i.title}}" selected>{{i.title}}</option>
                                      {%else%}
                                      <option value="{{i.title}}">{{i.title}}</option>
                                      {%endif%}
                                    {%endfor%}
                                  </select>
                                </div>
                                <div class="form-group row mt-4">
                                    <div class="col-12 form-check ml-2 mt-2">
                                        	  <input class="form-control form-control-sm" type="date" name="date_from" id="date_from">
                                              <input class="form-control form-control-sm" type="date" name="date_to" id="date_to">
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                <div class="row col-12 mt-3 justify-content-center text-white pt-5">
                    <div class="row col-12 col-md-6 m-0 p-0 justify-content-center">
                        <div class="row col-12 justify-content-center">
                            <h5 class="font-weight-bold pb-3 text-center">Effective Scores (vs Default media)</h5>
                        </div>
                    {%if score1:%}
                        <div class="row col-6 m-0 p-0">
<!--                            <div class="row col justify-content-center mb-2">-->
<!--                                <h4>{{report.first}}</h4>-->
<!--                            </div>-->
<!--                            <div class="col-4"></div>-->
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-center">
                                    <p style="color: {{color['overall']}}" class="m-0 p-0 font-weight-bold">Overall: {{"{:.1f}".format(score1.get('all').get('score'))}} % ({{score1.get('all').get('num')}}/{{score1.get('all').get('total')}})</p>
                                </div>
                            </div>
                            <div class="col-4"></div>
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-center">
                                    <p style="color: {{color['purpose']}}" class="m-0 p-0 font-weight-bold">Purpose: {{"{:.1f}".format(score1.get('purpose').get('score'))}} % ({{score1.get('purpose').get('num')}}/{{score1.get('purpose').get('total')}})</p>
                                </div>
                            </div>
                            <div class="col-4"></div>
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-center">
                                    <p style="color: {{color['craftsmanship']}}" class="m-0 p-0 font-weight-bold">Craftsmanship: {{"{:.1f}".format(score1.get('craftsmanship').get('score'))}} % ({{score1.get('craftsmanship').get('num')}}/{{score1.get('craftsmanship').get('total')}})</p>
                                </div>
                            </div>
                            <div class="col-4"></div>
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-center">
                                    <p style="color: {{color['aesthetic']}}" class="m-0 p-0 font-weight-bold">Aesthetic: {{"{:.1f}".format(score1.get('aesthetic').get('score'))}} % ({{score1.get('aesthetic').get('num')}}/{{score1.get('aesthetic').get('total')}})</p>
                                </div>
                            </div>
                            <div class="col-4"></div>
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-center">
                                    <p style="color: {{color['narrative']}}" class="m-0 p-0 font-weight-bold">Narrative: {{"{:.1f}".format(score1.get('narrative').get('score'))}} % ({{score1.get('narrative').get('num')}}/{{score1.get('narrative').get('total')}})</p>
                                </div>
                            </div>
                            <div class="col-4"></div>
                        </div>
                    {%endif%}

                    </div>

                    <div class="row col-12 col-md-6 m-0 p-0 justify-content-center">
                        <div class="row col-10 justify-content-center">
                            <h5 class="font-weight-bold pb-3 text-center">Top Matching Search Media Providers</h5>
                        </div>
                    {%if providers[0]:%}
                        <div class="row col-6 m-0 p-0">
<!--                            <div class="row col justify-content-center mb-2">-->
<!--                                <h4>{{report.first}}</h4>-->
<!--                            </div>-->
<!--                            <div class="col-4"></div>-->
                            {%if providers[0:]:%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">{{providers[0][0]}}: {{"{:.1f}".format(providers[0][1])}}%</p>
                                </div>
                            </div>
                            {%else%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">Provider Not Available</p>
                                </div>
                            </div>
                            {%endif%}
                            <div class="col-4"></div>
                            {%if providers[1:]:%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">{{providers[1][0]}}: {{"{:.1f}".format(providers[1][1])}}%</p>
                                </div>
                            </div>
                            {%else%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">Provider Not Available</p>
                                </div>
                            </div>
                            {%endif%}
                            <div class="col-4"></div>
                            {%if providers[2:]:%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">{{providers[2][0]}}: {{"{:.1f}".format(providers[2][1])}}%</p>
                                </div>
                            </div>
                            {%else%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">Provider Not Available</p>
                                </div>
                            </div>
                            {%endif%}
                            <div class="col-4"></div>
                            {%if providers[3:]:%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">{{providers[3][0]}}: {{"{:.1f}".format(providers[3][1])}}%</p>
                                </div>
                            </div>
                            {%else%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">Provider Not Available</p>
                                </div>
                            </div>
                            {%endif%}
                            <div class="col-4"></div>
                            {%if providers[4:]:%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">{{providers[4][0]}}: {{"{:.1f}".format(providers[4][1])}}%</p>
                                </div>
                            </div>
                            {%else%}
                            <div class="row col-8 justify-content-end text-secondary mb-2">
                                <div class="row col-12 justify-content-start">
                                    <p class="m-0 p-0 font-weight-bold">Provider Not Available</p>
                                </div>
                            </div>
                            {%endif%}
                            <div class="col-4"></div>
                        </div>
                    {%endif%}

                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mt-5">
        <div class='container'>
            <div class='row'>
                <div class='col-lg-12'>
                        <div class="form-group row justify-content-center">
                            <div class="row col-12 col-md-auto justify-content-center justify-content-md-end">
                                <label class="text-white mr-4"><h3 class="font-weight-bold m-0 p-0">Semantic Similarity:</h3></label>
                                <div class="col-10 col-md-auto">
                                  <select name="dimensions" id="dimension" class="form-control form-control-sm">
                                      {%for i in dimensions%}
                                        {%if(i==report.dimension)%}
                                          <option value="{{i}}" selected>{{i}}</option>
                                        {%else%}
                                          <option value="{{i}}">{{i}}</option>
                                        {%endif%}
                                      {%endfor%}
                                  </select>

                                </div>
                            </div>
                            <div class="row col-12 col-md-auto justify-content-center justify-content-md-start mt-3 mt-md-0">
                                <div class="col-4 col-md-auto">
                                    {%if( report and report.descending)%}
                                    <label style="color: white;"><input style="margin-right: 10px" name="descending" id="descending" type="checkbox" value="yes" checked>Descending</label>
                                    {%else%}
                                    <label style="color: white;"><input style="margin-right: 10px" name="descending" id="descending" type="checkbox" value="yes">Descending</label>
                                    {%endif%}
                                </div>
                                <div class="col-4 col-md-auto">
                                     {%if report%}
                                         <input style="width: 50px;" type="text" class="form-control form-control-sm ml-0 ml-md-2"  placeholder="Min" name="range_from" id="range_from" value="{{report.range_from}}">
                                     {%else%}
                                         <input style="width: 50px;" type="text" class="form-control form-control-sm ml-0 ml-md-2"  placeholder="Min" name="range_from" id="range_from">
                                     {%endif%}
                                </div>
                                <div class="col-4 col-md-auto">
                                   {%if report%}
                                        <input style="width: 50px;" type="text" class="form-control form-control-sm mr-0 mr-md-4"  placeholder="Min" name="range_to" id="range_to" value="{{report.range_to}}">
                                   {%else%}
                                        <input style="width: 50px;" type="text" class="form-control form-control-sm mr-0 mr-md-4"  placeholder="Max" name="range_to" id="range_to">
                                   {%endif%}
                                </div>
                                <button class="btn btn-primary btn-sm bg-theme mb-3" onclick="updateClick()" type="button">Update</button>
                            </div>
                        </div>
                </div>
            </div>
      </form>
            <div id="loadhere" class="row justify-content-center text-white">
             {%for i in sentences%}
                <div class="row col-10 mt-3 justify-content-center text-white">
                    <div class="row col-12 col-md-5 m-0 p-0 justify-content-end">
                           <h3 class="font-weight-bold text-right">{{report.first}}</h3>
                           <div class="row col-12 justify-content-end">
                             <form target="_blank" action="/companies/classifier" method="POST">
                               <input type="hidden" name="title" value="{{report.first}}">
                               <input type="hidden" name="sentence" value="{{i.sentence1}}">
                               <a class="text-right" type="button" onclick="this.parentElement.submit()" >{{i.sentence1}}</a><br>
                             </form>
                           </div>
                    </div>
                    <div class="row col-12 col-md-2">
                        <div class="col-12 block row justify-content-center m-0 p-0">
                            <div>
                                <img src="static/images/Oval.png" alt="oval" style="width:100%; position: relative;">
                                <div class="centered font-weight-bold" style="color: black;">{{i.similarity}}%</div>
                            </div>
                        </div>
                    </div>
                    <div class="row col-12 col-md-5 m-0 p-0 justify-content-start text-center mt-3 mt-md-0">
                       <input type="hidden" name="id" value="{{i.id2}}">
                      {%if i.title2|length < 5:%}
                          {%if "default:" in report.title%}
                                <a type="button" onclick="highlight(this,'{{i.id2}}')" id="{{i.sentence2}}"><h5 class="font-weight-bold text-left">NO TITLE FOUND ({{i.provider}})</h5></a>
                            {%else%}
                                <a type="button" onclick="highlight(this,'{{i.id2}}')" id="{{i.sentence2}}"><h5 class="font-weight-bold text-left">NO TITLE FOUND</h5></a>
                            {%endif%}
                      {%else%}
                            {%if "default:" in report.title%}
                              <a type="button" onclick="highlight(this,'{{i.id2}}')" id="{{i.sentence2}}"><h5 class="font-weight-bold text-left">{{i.title2}} ({{i.provider}})</h5></a>
                            {%else%}
                              <a type="button" onclick="highlight(this,'{{i.id2}}')" id="{{i.sentence2}}"><h5 class="font-weight-bold text-left">{{i.title2}}</h5></a>
                            {%endif%}
                      {%endif%}
                       <div class="row col-12 justify-content-start">
                           <form target="_blank" action="/searchquerydocuments/classifier" method="POST">
                               <input type="hidden" name="query_document_id" value="{{i.id2}}">
                               <input type="hidden" name="sentence" value="{{i.sentence2}}">
                               <a class="text-left" type="button" onclick="this.parentElement.submit()" >{{i.sentence2}}</a><br>
                           </form>
                       </div>
                    </div>
                </div>
             {%endfor%}
                <div id="loadbuttondiv" class='row justify-content-center text-center text-white col-lg-12 mt-3'>
                    <button class="btn btn-primary bg-theme" id="load" type="button" onclick="loadhere()">Load More</button>
                </div>

            </div>
        </div>
    </section>

    <footer></footer>

    <script src='https://code.jquery.com/jquery-3.4.1.slim.min.js' integrity='sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n' crossorigin='anonymous'></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type=text/javascript>
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    </script>
    <script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js' integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo' crossorigin='anonymous'></script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js' integrity='sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6' crossorigin='anonymous'></script>
<script>


var date = new Date({{date_from}});
date ;
date.setDate(date.getDate() + 1);

document.getElementById('date_from').valueAsDate = date;

var date = new Date({{date_to}});
date ;
date.setDate(date.getDate() + 1);

document.getElementById('date_to').valueAsDate = date;

var offset = 21;
report_title = "{{report.title}}";

function loadhere(){
    $.post( "/loadmore", { id:{{report.id}},offset: offset})
    .done(function( data ) {
                s = data['data']
                document.getElementById("loadbuttondiv").remove();

        for(i=0;i<s.length;i++){
            if(s[i]['title'].length < 5){
                $("#loadhere").append('<div class="row col-10 mt-3 justify-content-center text-white"><div class="row col-12 col-md-5 m-0 p-0 justify-content-end"><h3 class="font-weight-bold text-right">{{report.first}}</h3><div class="row col-12 justify-content-end"><form target="_blank" action="/companies/classifier" method="POST"><input type="hidden" name="title" value="{{report.first}}"><input type="hidden" name="sentence" value="'+s[i]["sentence1"]+'"><a class="text-right" type="button" onclick="this.parentElement.submit()" >'+s[i]["sentence1"]+'</a><br></form></div></div><div class="row col-12 col-md-2"><div class="col-12 block row justify-content-center m-0 p-0"><div class="circle"><p>'+s[i]["similarity"]+'%</p></div></div></div><div class="row col-12 col-md-5 m-0 p-0 justify-content-start text-center mt-3 mt-md-0"><input type="hidden" name="id" value="'+s[i]["id"]+'">{%if "default:" in report.title%}<a type="button" onclick="highlight(this,\''+s[i]["id"]+'\')" id="'+s[i]["sentence2"]+'"><h5 class="font-weight-bold text-left">NO TITLE FOUND ('+s[i]["provider"]+')</h5></a>{%else%}<a type="button" onclick="highlight(this,\''+s[i]["id"]+'\')" id="'+s[i]["sentence2"]+'"><h5 class="font-weight-bold text-left">NO TITLE FOUND</h5></a>{%endif%}<div class="row col-12 justify-content-start"><form target="_blank" action="/searchquerydocuments/classifier" method="POST"><input type="hidden" name="query_document_id" value="'+s[i]["id"]+'"><input type="hidden" name="sentence" value="'+s[i]["sentence2"]+'"><a class="text-left" type="button" onclick="this.parentElement.submit()" >'+s[i]["sentence2"]+'</a><br></form></div></div></div>');
            }
            else{
                $("#loadhere").append('<div class="row col-10 mt-3 justify-content-center text-white"><div class="row col-12 col-md-5 m-0 p-0 justify-content-end"><h3 class="font-weight-bold text-right">{{report.first}}</h3><div class="row col-12 justify-content-end"><form target="_blank" action="/companies/classifier" method="POST"><input type="hidden" name="title" value="{{report.first}}"><input type="hidden" name="sentence" value="'+s[i]["sentence1"]+'"><a class="text-right" type="button" onclick="this.parentElement.submit()" >'+s[i]["sentence1"]+'</a><br></form></div></div><div class="row col-12 col-md-2"><div class="col-12 block row justify-content-center m-0 p-0"><div class="circle"><p>'+s[i]["similarity"]+'%</p></div></div></div><div class="row col-12 col-md-5 m-0 p-0 justify-content-start text-center mt-3 mt-md-0"><input type="hidden" name="id" value="'+s[i]["id"]+'">{%if "default:" in report.title%}<a type="button" onclick="highlight(this,\''+s[i]["id"]+'\')" id="'+s[i]["sentence2"]+'"><h5 class="font-weight-bold text-left">'+s[i]["title"]+' ('+s[i]["provider"]+')</h5></a>{%else%}<a type="button" onclick="highlight(this,\''+s[i]["id"]+'\')" id="'+s[i]["sentence2"]+'"><h5 class="font-weight-bold text-left">'+s[i]["title"]+'</h5></a>{%endif%}<div class="row col-12 justify-content-start"><form target="_blank" action="/searchquerydocuments/classifier" method="POST"><input type="hidden" name="query_document_id" value="'+s[i]["id"]+'"><input type="hidden" name="sentence" value="'+s[i]["sentence2"]+'"><a class="text-left" type="button" onclick="this.parentElement.submit()" >'+s[i]["sentence2"]+'</a><br></form></div></div></div>');
            }
        }
        offset+=20;
        $("#loadhere").append('<div id="loadbuttondiv" class="row justify-content-center text-center text-white col-lg-12 mt-3"><button class="btn btn-primary bg-theme" id="load" type="button" onclick="loadhere()">Load More</button></div>')
    });
}



function updateClick(){
    var range_from = document.getElementById("range_from");
    var range_to = document.getElementById("range_to");
    var descending = document.getElementById("descending");
    var up_to_date = document.getElementById("up_to_date");
    var dimension = document.getElementById("dimension");
    var title = document.getElementById("title");
    $.post( "/updatereport", { id: {{report.id}},type:"{{report.type}}",range_from: range_from.value,range_to: range_to.value,descending:descending.checked,up_to_date:up_to_date.checked,dimension:dimension.value,title:title.value}).done(function( data ) {
      if(data=="done"){
        window.location.replace("/reporttest?id={{report.id}}");
      }
      else{
        alert("error")
      }
    });
  }
  function deleteClick(id) {
    window.location.href = "/deletereport?id="+id;
  }
function opendoc(id) {
  window.location.href = "/searchqueries/editsearchquerydocument?id="+id;
}
function highlight(obj,id) {
    $.post( "/highlight", { id: id,sentence:obj.id }).done(function( data ) {
      if(data=="error"){
        alert("error");
      }
      else{
        window.open(data, '_blank').focus();
      }
    })
}
</script>

{% endblock %}
</body>
</html>