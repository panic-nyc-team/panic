{% extends "new_layout.html" %}
{% block title %}Add Company{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
<body>
{% block content %}
    <section class="mt-5">
        <div class='container pt-5'>
            <div class='row justify-content-center'>
                <div class='row justify-content-center text-center text-white col-lg-12'>
                    <h3>Add Company</h3>
                </div>
              <form action="/companies/savecompany" id="myform" class="needs-validation" novalidate method="post">
                     <input type="hidden" name="old_title" value="{{companydocument.title}}">
                     <input type="hidden" id="industry_tags" name="industry_tags" value="{{companydocument.industry_tags}}">
                <div class="row col-12 mt-3">
                    <div class='col-lg-12'>
                            <div class="form-group text-white">
                              <label>Title</label>
                              <input type="text" class="form-control"  placeholder="Enter Title" name="title" required value="{{companydocument.title}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Clean Text</label>
                                <textarea type="text" rows="15" cols="260" class="form-control"  name="clean_text">{{companydocument.clean_text}}</textarea>
                            </div>
                        <div  class="form-group" style="display: flex; flex-direction: row" >
                          <div>

                         <select  class="form-control" id="myInput" onchange=newElement()>
                              <option selected>Select Tag</option>
                              {%if industrytags%}
                              {%for tag in industrytags:%}
                                <option>{{tag.title}}</option>
                              {%endfor%}
                              {%endif%}
                          </select>

                             </div>
                          <div style="margin-left: 80px">
                          <div class="flex-tags">
                       <!-- onchange function in input adds list here using JS-->
                       <ul id="myUL">
                        </ul>
                      </div>

                        </div>
                        </div>

<!--                          {%if score%}-->
<!--                          <div class="form-group" style="display: flex; flex-direction: row" id="classifiactionResult">-->
<!--                              <label style="color: grey;"> All: {{"{:.1f}".format(score.get('all').get('score'))}} % ({{score.get('all').get('num')}}/{{score.get('all').get('total')}})  &nbsp &nbsp</label>-->
<!--                              <label style="color: lightgreen;">Purpose: {{"{:.1f}".format(score.get('purpose').get('score'))}} % ({{score.get('purpose').get('num')}}/{{score.get('purpose').get('total')}}) &nbsp &nbsp</label>-->
<!--                              <label style="color: orange;">Craftsmanship: {{"{:.1f}".format(score.get('craftsmanship').get('score'))}} % ({{score.get('craftsmanship').get('num')}}/{{score.get('craftsmanship').get('total')}}) &nbsp &nbsp</label>-->
<!--                              <label style="color: lightblue;">Aesthetics: {{"{:.1f}".format(score.get('aesthetic').get('score'))}} % ({{score.get('aesthetic').get('num')}}/{{score.get('aesthetic').get('total')}}) &nbsp &nbsp</label>-->
<!--                              <label style="color: grey;"> Narrative: {{"{:.1f}".format(score.get('narrative').get('score'))}} % ({{score.get('narrative').get('num')}}/{{score.get('narrative').get('total')}}) &nbsp &nbsp</label>-->
<!--                          </div>-->
<!--                          {%endif%}-->

<!--                            <div class="form-group text-white">-->
<!--                                <label>Select Default Query</label>-->
<!--                                <div class="form-group" style="display: flex; flex-direction: row">-->
<!--                                      <select name="reference_to_search_query" id="cars" class="form-control">-->
<!--                                          <option value="empty" selected>Select Default Query</option>-->
<!--                                          {%if searchqueries%}-->
<!--                                            {%for i in searchqueries:%}-->
<!--                                              {%if(companydocument.reference_to_search_query==i.title)%}-->
<!--                                                <option value="{{i.title}}" selected>{{i.title}}</option>-->
<!--                                              {%else%}-->
<!--                                                <option value="{{i.title}}">{{i.title}}</option>-->
<!--                                              {%endif%}-->
<!--                                            {%endfor%}-->
<!--                                          {%endif%}-->
<!--                                      </select>-->
<!--&lt;!&ndash;                                    <div class="mt-2 mt-md-0 form-group text-white col-6 col-md-3 row justify-content-center">&ndash;&gt;-->
<!--&lt;!&ndash;                                        <div class="row col-auto">&ndash;&gt;-->
<!--                                              {%if(companydocument.run_query_score)%}-->
<!--                                              <label style="margin-left: 100px" class="form-check-label"><input type="checkbox" checked class="form-check-input" name="run_query_score" value="yes">Run Automatically</label>-->
<!--                                              {%else%}-->
<!--                                              <label style="margin-left: 100px" class="form-check-label"><input type="checkbox" class="form-check-input" name="run_query_score" value="yes">Run Automatically</label>-->
<!--                                              {%endif%}-->
<!--&lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--&lt;!&ndash;                                    </div>&ndash;&gt;-->
<!--                                    <div class="mt-2 mt-md-0 col-6 col-md-3 text-center">-->
<!--&lt;!&ndash;                                        <a href="#">View Query Report</a>&ndash;&gt;-->
<!--                                        <button onclick="viewReport()" type="button" style="color:blueviolet; background-color: inherit; border-color: inherit; border:none"><b>View Query Report</b></button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
                        </form>
                    </div>
                </div>
                <div class='row justify-content-center text-center text-white col-lg-12 my-3'>
                      <button class="btn btn-primary bg-theme mx-1" onclick="submitForm()" >Save</button>
                      <form action="/companies/classifier" method="POST">
                        <button class="btn btn-primary bg-theme mx-1" type="submit" onclick="myClassifiedSentences()" >See Classified Sentences</button>
                        <input type="hidden" name="title" value="{{companydocument.title}}">
                      </form>
                      <button class="btn btn-danger mx-1" type="button" onclick="deleteCompany()" >Delete</button>
                </div>
            </div>
        </div>
    </section>
    <footer></footer>

    <script src='https://code.jquery.com/jquery-3.4.1.slim.min.js' integrity='sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js' integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo' crossorigin='anonymous'></script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js' integrity='sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6' crossorigin='anonymous'></script>
    <script>
      function submitForm(){
      var s = tags.join(",");
      console.log(s);
      document.getElementById("industry_tags").value = s;
      document.getElementById("myform").submit();
    }
    function viewReport(){
          {%if(report)%}
            window.location.href = "/reporttest?id="+{{report.id}};
          {%endif%}
    }
    function myClassifiedSentences(){
          window.location.href = "/companies/seeclassifiedsentences?title="+"{{companydocument.title}}";
      }
    function deleteCompany(){
          window.location.href = "/companies/deletecompany?title="+"{{companydocument.title}}";
      }

    var tags = []
    {%if companydocument.industry_tags%}
    {%for tag in companydocument.industry_tags.split(',')%}
      var inputValue = "{{tag}}";
      work(inputValue);
    {%endfor%}
    {%endif%}

    function newElement(inputValue) {
      var inputValue = document.getElementById("myInput").value;
      if(tags.includes(inputValue) || inputValue ==='Select Tag'){
        return;
      }
      work(inputValue)
    }


    function work(inputValue){
      tags.push(inputValue);
      var li = document.createElement("li");
      var t = document.createTextNode(inputValue);

      if (inputValue === '') {
        alert("You must write something!");
      } else {
        document.getElementById("myUL").appendChild(li);

      }
      document.getElementById("myInput").value = "";

      var span = document.createElement("SPAN");
      var txt = document.createTextNode("\u00D7");
      var btn= document.createElement("button");
      btn.className="mybutton";
      btn.onclick = function(){
        return false;
      }
      btn.appendChild(t);
      li.appendChild(btn);
      span.className = "close";
      span.appendChild(txt);
      li.appendChild(span);

      var close = document.getElementsByClassName("close");
      var i;
      for (i = 0; i < close.length; i++) {
        close[i].onclick = function() {
          const index = tags.indexOf(this.previousSibling.innerHTML);
          if (index > -1) {
            tags.splice(index, 1);
          }
          var div = this.parentElement;
          div.style.display = "none";
        }
      }
      document.getElementById("myInput").options.selectedIndex = 0;
    }
    </script>
{% endblock %}
</body>
</html>