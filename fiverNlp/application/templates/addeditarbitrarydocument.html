{% extends "new_layout.html" %}
{% block title %}Add Arbitrary Document{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
<body>
{% block content %}

    <section class="mt-5">
  <form action="/arbitrarydocuments/savearbitrarydocument" id="myform" novalidate method="post">
     <input type="hidden" name="old_title" value="{{arbitrarydocument.title}}">
     <input type="hidden" id="industry_tags" name="industry_tags" value="{{arbitrarydocument.industry_tags}}">
        <div class='container pt-5'>
            <div class='row justify-content-center'>
                <div class='row justify-content-center text-center text-white col-lg-12'>
                    <h1>Arbitrary Document</h1>
                </div>
                <div class="row col-12 mt-3">
                    <div class='col-lg-12'>
                            <div class="form-group text-white">
                              <label>Title</label>
                              <input type="text" class="form-control"  name="title" placeholder="Enter title" required value="{{arbitrarydocument.title}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Clean Text</label>
                                <textarea class="form-control" rows="15" placeholder="Enter title" name="clean_text">{{arbitrarydocument.clean_text}}</textarea>
                            </div>

                            <div  class="form-group" style="display: flex; flex-direction: row" >
                              <div>

                             <select  class="form-control" id="myInput" onchange=newElement()>
                                  <option selected>Select Tag</option>
                                  {%if industrytags%}
                                  {%for tag in industrytags:%}
                                    <option>{{tag.title}}</option>
                                  {%endfor%}
                                  {%endif%}
                              </select>

                                 </div>
                              <div style="margin-left: 80px">
                              <div class="flex-tags">
                           <!-- onchange function in input adds list here using JS-->
                           <ul id="myUL">
                            </ul>
                          </div>

                            </div>
                            </div>
                            <div class="form-group text-white">
                                <label>Date</label>
                                <input type="text" class="form-control"  placeholder="Enter Date" name="date" value="{{arbitrarydocument.date}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Author</label>
                                <input type="text" class="form-control"  placeholder="Enter Author Name" name="author" value="{{arbitrarydocument.author}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Provider</label>
                                <input type="text" class="form-control"  placeholder="Enter Provider" name="provider" value="{{arbitrarydocument.provider}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Url</label>
                                <input type="text" class="form-control"  placeholder="Enter Url" name="url" value="{{arbitrarydocument.url}}">
                            </div>
                            <div class="form-group text-white">
                                <label>Image Url</label>
                                <input type="text" class="form-control"  placeholder="Enter Image Url" name="image_url" value="{{arbitrarydocument.image_url}}">
                            </div>
                    </div>
                </div>
                <div class='row justify-content-center text-center text-white col-lg-12 my-3'>
                      <button class="btn btn-primary bg-theme mx-1" onclick="submitForm()" type="button">Save</button>
                        </form>
                      <form action="/arbitrarydocuments/classifier" method="POST">
                        <button class="btn btn-primary bg-theme mx-1" type="submit" onclick="myClassifiedSentences()" >See Classified Sentences</button>
                        <input type="hidden" name="title" value="{{arbitrarydocument.title}}">
                      </form>
                      <button class="btn btn-danger mx-1" type="button" onclick="deleteCompany()" >Delete</button>
                </div>
            </div>
        </div>
    </section>
    <footer></footer>

    <script src='https://code.jquery.com/jquery-3.4.1.slim.min.js' integrity='sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js' integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo' crossorigin='anonymous'></script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js' integrity='sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6' crossorigin='anonymous'></script>
    <script>
    function submitForm(){
      var s = tags.join(",");
      console.log(s);
      document.getElementById("industry_tags").value = s;
      document.getElementById("myform").submit();
    }
    function viewReport(){
          {%if(report)%}
            window.location.href = "/reporttest?id="+{{report.id}};
          {%endif%}
    }
    function myClassifiedSentences(){
          window.location.href = "/arbitrarydocuments/seeclassifiedsentences?title="+"{{arbitrarydocument.title}}";
      }
    function deleteCompany(){
          window.location.href = "/arbitrarydocuments/delete?title="+"{{arbitrarydocument.title}}";
      }

    var tags = []
    {%if arbitrarydocument.industry_tags%}
    {%for tag in arbitrarydocument.industry_tags.split(',')%}
      var inputValue = "{{tag}}";
      work(inputValue);
    {%endfor%}
    {%endif%}

    function newElement(inputValue) {
      var inputValue = document.getElementById("myInput").value;
      if(tags.includes(inputValue) || inputValue ==='Select Tag'){
        return;
      }
      work(inputValue)
    }


    function work(inputValue){
      tags.push(inputValue);
      var li = document.createElement("li");
      var t = document.createTextNode(inputValue);

      if (inputValue === '') {
        alert("You must write something!");
      } else {
        document.getElementById("myUL").appendChild(li);

      }
      document.getElementById("myInput").value = "";

      var span = document.createElement("SPAN");
      var txt = document.createTextNode("\u00D7");
      var btn= document.createElement("button");
      btn.className="mybutton";
      btn.onclick = function(){
        return false;
      };
      btn.appendChild(t);
      li.appendChild(btn);
      span.className = "close";
      span.appendChild(txt);
      li.appendChild(span);

      var close = document.getElementsByClassName("close");
      var i;
      for (i = 0; i < close.length; i++) {
        close[i].onclick = function() {
          const index = tags.indexOf(this.previousSibling.innerHTML);
          if (index > -1) {
            tags.splice(index, 1);
          }
          var div = this.parentElement;
          div.style.display = "none";
        }
      }
      document.getElementById("myInput").options.selectedIndex = 0;
    }
    </script>
{% endblock %}

</body>
</html>